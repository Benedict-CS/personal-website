# 文章版本控制系統

## 功能說明

系統現在支援自動版本控制功能，每次編輯文章時會自動保存版本歷史，讓你可以：

- ✅ **自動保存版本**：每次更新文章時，系統會自動保存當前版本
- ✅ **查看版本歷史**：可以查看所有歷史版本
- ✅ **恢復到舊版本**：如果修改錯誤，可以恢復到任何歷史版本
- ✅ **版本比較**：可以看到每個版本的標題、內容、標籤等資訊

## 如何使用

### 1. 執行資料庫遷移

首先需要執行 migration 來創建版本控制表：

```bash
# 在 Docker 容器內執行
sudo docker compose exec app npx prisma migrate deploy

# 或手動執行 migration
sudo docker compose exec app npx prisma db push
```

### 2. 查看版本歷史

1. 進入後台編輯文章頁面
2. 點擊右上角的「版本歷史」按鈕
3. 會顯示所有歷史版本，包括：
   - 版本號
   - 保存時間
   - 標題、Slug、標籤、狀態
   - 內容預覽

### 3. 恢復到舊版本

1. 打開版本歷史對話框
2. 找到要恢復的版本
3. 點擊「恢復到此版本」按鈕
4. 確認後，系統會：
   - 自動保存當前版本（如果與要恢復的版本不同）
   - 恢復文章到選定的版本
   - 更新編輯頁面的內容

## 技術細節

### 資料庫結構

- **PostVersion 表**：儲存所有版本歷史
  - `postId`：關聯到文章
  - `versionNumber`：版本號（遞增）
  - `title`, `slug`, `content`, `published`：文章內容
  - `tags`：標籤（JSON 格式）
  - `createdAt`：版本創建時間

### 自動保存機制

- 只有在**實際有變更**時才會保存版本
- 比較項目：標題、內容、Slug、發布狀態、標籤
- 如果沒有變更，不會創建新版本（避免浪費空間）

### 恢復機制

- 恢復前會自動保存當前版本
- 確保不會丟失任何版本
- 恢復後會更新編輯頁面，讓你可以繼續編輯

## 注意事項

1. **版本不會自動刪除**：目前版本會永久保存，如果文章很多，可能需要定期清理舊版本
2. **儲存空間**：每個版本都會完整保存文章內容，請注意資料庫大小
3. **標籤處理**：標籤以 JSON 格式儲存，恢復時會重新連接標籤

## 未來改進

- [ ] 限制每個文章的最大版本數（如只保留最近 10 個版本）
- [ ] 版本差異比較功能
- [ ] 版本備註功能（可以為每個版本添加說明）
- [ ] 批量清理舊版本功能
